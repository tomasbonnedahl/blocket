<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Blocket</title>
</head>
<body>
    <canvas id="myChart"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>
        function plotIt(theXYPoints) {
            var ctx = document.getElementById('myChart').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'scatter',

<!--                data: {-->
<!--                    datasets: [{-->
<!--                        label: 'Aug 2019',-->
<!--                        borderColor: 'rgb(255, 99, 132)',-->
<!--                        data: points-->
<!--                    },{-->
<!--                        label: 'Sep 2019',-->
<!--                        borderColor: 'rgb(255, 99, 132)',-->
<!--                        data: points-->
<!--                    },-->

                data: theXYPoints,
<!--                data: {-->
<!--                    datasets: [{-->
<!--                        label: 'Actual data',-->
<!--                        &lt;!&ndash;backgroundColor: 'rgb(255, 99, 132)',&ndash;&gt;-->
<!--                        borderColor: 'rgb(255, 99, 132)',-->
<!--                        &lt;!&ndash;data: [0, 10, 5]&ndash;&gt;-->
<!--                        data: theXYPoints-->
<!--                    }, {-->
<!--                        label: '2017 August',-->
<!--                        &lt;!&ndash;backgroundColor: 'rgb(23, 23, 132)',&ndash;&gt;-->
<!--                        borderColor: 'rgb(23, 23, 132)',-->
<!--                        &lt;!&ndash;data: [0, 10, 5]&ndash;&gt;-->
<!--                        data: [-->
<!--                        { x: 1783, y: 329900 },-->
<!--                        { x: 2200, y: 329900 },-->
<!--                        { x: 2815, y: 329900 },-->
<!--                        { x: 3298, y: 329900 },-->
<!--                        { x: 4374, y: 324900 },-->
<!--                        { x: 4438, y: 319900 },-->
<!--                        { x: 4752, y: 314900 },-->
<!--                        { x: 4995, y: 324900 },-->
<!--                        ]-->
<!--                    }]-->
<!--                },-->

                // Configuration options go here
                options: {
                    legend: {
                          display: true,
                          position: 'bottom',
                          labels: {
                            fontColor: "#000080",
                          }
                    },
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                return data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index].tooltip;
                            }
                        }
                    }
                }
            });
        }

        const url = window.location.origin + '/json-data'
        fetch(url)
            .then((resp) => resp.json())
            .then(function(data) {
                let carsByMonth = data.dataByMonth;

                var listOfDatasets = []

                console.log("data: " + data);
                console.log("carsByMonth: " + carsByMonth);
                for (const [key, value] of Object.entries(carsByMonth)) {
                    console.log("obj entry: " + key + ": " + value);

                    newValz = value.map(function(each) {
                        return {'x': each.milage, 'y': each.price, 'tooltip': each.tooltip};
                    });

                    carsByMonth[key] = newValz;

                    newValz.forEach(function(e) {
                        for (const [k2, v2] of Object.entries(e)) {
                            console.log("k2/v2: " + k2 + ": " + v2);
                        }
                    });

                    let aNewDict = {"label": key, "data": newValz, "backgroundColor": 'rgb(23, 23, 132)'};
                    listOfDatasets.push(aNewDict);
                }

                // Validate
                console.log("Validation");
                for (const [key, value] of Object.entries(carsByMonth)) {
                    console.log("entry: " + key + ": " + value);
                    value.forEach(function(e) {
                        for (const [k3, v3] of Object.entries(e)) {
                            console.log("validate key/validate value: " + k3 + ": " + v3);
                        }
                    });
                }

                console.log("Validation 2");
                listOfDatasets.forEach(function(e) {
                    for (const [key, value] of Object.entries(e)) {
                        console.log("key/value: " + key + ": " + value);
                    }
                    e["data"].forEach(function(e2) {
                        for (const[k3, v3] of Object.entries(e2)) {
                            console.log("k3/v3: " + k3 + ": " + v3);
                        }
                    });
                });

<!--                var oneDataset = {"label": "Aug 2019", "data": xyPoints}-->
<!--                var anotherDataset = {"label": "Aug 2019", "data": xyPoints}-->
<!--                var datasetList = [oneDataset, anotherDataset];-->
                var datasets = {"datasets": listOfDatasets};
                var d = {"data": datasets};
                plotIt(datasets);
                let tempData = [{'x': 4000, 'y': 350000, 'tooltip': "tooltip"}];
                let tempDS = [{"label": "the label", "data": tempData, "backgroundColor": 'rgb(23, 23, 132)'}];
                let tempOverall = {"datasets": tempDS};

                console.log("Validation 3 - real");
                d["data"]["datasets"].forEach(function(e) {
                    for (const [key, value] of Object.entries(e)) {
                        console.log("key/value: " + key + ": " + value);
                    }
                    e["data"].forEach(function(e2) {
                        for (const[k3, v3] of Object.entries(e2)) {
                            console.log("k3/v3: " + k3 + ": " + v3);
                        }
                    });
                });

                console.log("Validation 4 - temp");
                listOfDatasets.forEach(function(e) {
                    for (const [key, value] of Object.entries(e)) {
                        console.log("key/value: " + key + ": " + value);
                    }
                    e["data"].forEach(function(e2) {
                        for (const[k3, v3] of Object.entries(e2)) {
                            console.log("k3/v3: " + k3 + ": " + v3);
                        }
                    });
                });

<!--                plotIt(tempOverall);-->
            })
            .catch(function(error) {
            console.log(JSON.stringify(error));
        });

    </script>
</body>
</html>